var app=angular.module("Fusball",["ngRoute"]);app.config(["$routeProvider","$httpProvider",function(a,b){b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],a.when("/",{templateUrl:"templates/home.html",controller:"HomeController"}).when("/users",{templateUrl:"templates/users.html",controller:"UserController"}).when("/pickuser",{templateUrl:"templates/users.html",controller:"UserController"}).when("/statistics",{templateUrl:"templates/statistics.html",controller:"StatisticsController"}).when("/Users/:UserId",{templateUrl:"templates/user.html",controller:"UserIDController"}).when("/table",{templateUrl:"templates/newHome.html",controller:"newHomeController"}).when("/addUser",{templateUrl:"templates/addUser.html",controller:"adminController"}).otherwise({redirectTo:"/"})}]),app.factory("PlayersService",[function(){var a,b,c,d,e,f=!1;return{setPlayer11:function(b){a=b},setPlayer12:function(a){b=a},setPlayer21:function(a){c=a},setPlayer22:function(a){d=a},setCurrent:function(a){e=a},setPlayers:function(e){a=e[0],b=e[1],c=e[2],d=e[3]},getPlayer11:function(){return a},getPlayer12:function(){return b},getPlayer21:function(){return c},getPlayer22:function(){return d},getCurrent:function(){return e},clearPlayers:function(){a=null,b=null,c=null,d=null,e=null},clearCurrent:function(){e=null},rematch:function(){var e=a;a=c,c=e,e=b,b=d,d=e},setGameOn:function(a){f=a},getGameOn:function(){return f}}}]),app.factory("SocketService",["$http",function(){var a;return{setConnected:function(b){a=b},getSocket:function(){return a}}}]),app.controller("adminController",["$scope","$http","$location","SocketService","PlayersService",function(a,b,c){a.newName="",a.newImagePath="",a.addUser=function(a,d){var e={Name:a,ImagePath:d},f=JSON.stringify(e),g={method:"POST",url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/tempUser.xsjs",headers:{"Content-Type":"application/json",dataType:"json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="},data:f};console.log(e),b(g).success(function(){console.log("successfully added user"),c.path("/")}).error(function(a){console.log(a)})}}]),app.controller("HomeController",["$scope","$location","SocketService","PlayersService",function(a,b,c,d){var e="10.41.112.52:3000/",f=io.connect(e),g=!1;$.ajax({url:"http://"+e+"players",type:"GET",success:function(b){b.length?(a.player11=b[0],a.player12=b[1],a.player21=b[2],a.player22=b[3],d.setPlayers(b),g=!0,d.setGameOn(!0),a.$digest()):(a.player11="Player 1",a.player12="Player 2",a.player21="Player 1",a.player22="Player 2",d.setCurrent(null),d.getPlayer11()&&(a.player11=d.getPlayer11(),d.setCurrent(null)),d.getPlayer12()&&(a.player12=d.getPlayer12(),d.setCurrent(null)),d.getPlayer21()&&(a.player21=d.getPlayer21(),d.setCurrent(null)),d.getPlayer22()&&(a.player22=d.getPlayer22(),d.setCurrent(null)),d.getPlayer11()&&d.getPlayer12()&&d.getPlayer21()&&d.getPlayer22()&&$("#startGame").show(),a.$digest())}}),$.ajax({url:"http://"+e+"getScore",type:"GET",success:function(a){$("#team1").text(a[0]),$("#team2").text(a[1])}}),f.on("goal1",function(a){$("#team1").text(a)}),f.on("goal2",function(a){$("#team2").text(a)}),f.on("gameover",function(){$("#Rematch").show(),$("#newGame").show(),console.log("gameover")}),f.on("updatePlayers",function(b){d.setPlayers(b),a.player11=b[0],a.player12=b[1],a.player21=b[2],a.player22=b[3],a.$digest(),a.player11&&a.player12&&a.player21&&a.player22&&($("#startGame").hide(),$("#Rematch").hide(),$("#newGame").hide())}),a.clearCurrent=function(){console.log("worked")},a.clickplayer=function(c){g?11==c?b.path("/Users/"+a.player11.UserId):12==c?b.path("/Users/"+a.player12.UserId):21==c?b.path("/Users/"+a.player21.UserId):22==c&&b.path("/Users/"+a.player22.UserId):(d.setCurrent(c),b.path("/pickuser"))},a.gotoStatistics=function(){b.path("/statistics")},a.createGame=function(){$("#startGame").hide();var a={team1user1UserId:d.getPlayer11().UserId,team1user1Name:d.getPlayer11().Name,team1user1ImagePath:d.getPlayer11().ImagePath,ELO0:d.getPlayer11().ELO,team1user2UserId:d.getPlayer12().UserId,team1user2Name:d.getPlayer12().Name,team1user2ImagePath:d.getPlayer12().ImagePath,ELO1:d.getPlayer12().ELO,team2user1UserId:d.getPlayer21().UserId,team2user1Name:d.getPlayer21().Name,team2user1ImagePath:d.getPlayer21().ImagePath,ELO2:d.getPlayer21().ELO,team2user2UserId:d.getPlayer22().UserId,team2user2Name:d.getPlayer22().Name,team2user2ImagePath:d.getPlayer22().ImagePath,ELO3:d.getPlayer22().ELO};$.ajax({url:"http://"+e+"start",type:"POST",data:a,success:function(){g=!0,d.setGameOn(!0)}})},a.rematch=function(){d.rematch(),a.createGame(),a.player11=d.getPlayer11(),a.player12=d.getPlayer12(),a.player21=d.getPlayer21(),a.player22=d.getPlayer22(),$("#Rematch").hide(),$("#newGame").hide()},a.newGame=function(){g=!1,d.setGameOn(!1),$("#team1").text(0),$("#team2").text(0),d.clearPlayers(),a.player11=null,a.player12=null,a.player21=null,a.player22=null}}]),app.controller("StatisticsController",["$scope","$location","SocketService",function(){}]),app.controller("UserController",["$scope","$location","SocketService","PlayersService",function(a,b,c,d){function e(c){for(var e=!1,f=[],g=0;g<c.length;g++)d.getPlayer11()&&"/users"!=b.$$path&&d.getPlayer11().UserId==c[g].UserId&&(e=!0),d.getPlayer12()&&"/users"!=b.$$path&&d.getPlayer12().UserId==c[g].UserId&&(e=!0),d.getPlayer21()&&"/users"!=b.$$path&&d.getPlayer21().UserId==c[g].UserId&&(e=!0),d.getPlayer22()&&"/users"!=b.$$path&&d.getPlayer22().UserId==c[g].UserId&&(e=!0),e||f.push(c[g]),e=!1;a.arr=f,a.$digest()}var f={"Content-Type":"application/json",dataType:"json",Accept:"application/json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="};$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/tempUser.xsjs",type:"GET",dataType:"json",headers:f,contentType:"application/json; charset=utf-8",success:function(a){e(a),console.log(a)}}),a.thisPlayer=function(a){d.getCurrent()?(11==d.getCurrent()?d.setPlayer11(a):12==d.getCurrent()?d.setPlayer12(a):21==d.getCurrent()?d.setPlayer21(a):22==d.getCurrent()&&d.setPlayer22(a),b.path("/")):b.path("/Users/"+a.UserId)},a.randomPlayers=function(){for(var c=[];c.length<4;){for(var e=Math.ceil(Math.random()*a.arr.length-1),f=!1,g=0;g<c.length;g++)if(c[g]==e){f=!0;break}f||(c[c.length]=e)}d.setPlayer11(a.arr[c[0]]),d.setPlayer12(a.arr[c[1]]),d.setPlayer21(a.arr[c[2]]),d.setPlayer22(a.arr[c[3]]),b.path("/")}}]),app.controller("UserIDController",["$scope","$location","$routeParams","SocketService","PlayersService",function(a,b,c){a.user={},a.winp=0;var d={"Content-Type":"application/json",dataType:"json",Accept:"application/json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="};$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/userStatistics.xsjs",type:"GET",dataType:"json",headers:d,contentType:"application/json; charset=utf-8",data:{id:c.UserId},success:function(b){console.log(b),a.user=b,a.winp=(a.user[0].TOTWINS/a.user[0].NOGAMES*100).toFixed(2),a.$digest()},error:function(a){return console.log("error : "),a}})}]);