var app=angular.module("Fusball",["ngRoute"]);app.config(["$routeProvider","$httpProvider",function(a,b){b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],a.when("/",{templateUrl:"templates/home.html",controller:"HomeController"}).when("/users",{templateUrl:"templates/users.html",controller:"UserController"}).when("/pickuser",{templateUrl:"templates/users.html",controller:"UserController"}).when("/statistics",{templateUrl:"templates/statistics.html",controller:"StatisticsController"}).when("/Users/:UserId",{templateUrl:"templates/user.html",controller:"UserIDController"}).when("/table",{templateUrl:"templates/table.html",controller:"TableController"}).when("/editUser/:UserId",{templateUrl:"templates/editUser.html",controller:"UserIDController"}).when("/changePassword/:UserId",{templateUrl:"templates/changePassword.html",controller:"UserIDController"}).when("/addUser",{templateUrl:"templates/addUser.html",controller:"adminController"}).otherwise({redirectTo:"/"})}]),app.factory("PlayersService",[function(){var a,b,c,d,e,f=!1;return{setPlayer11:function(b){a=b},setPlayer12:function(a){b=a},setPlayer21:function(a){c=a},setPlayer22:function(a){d=a},setCurrent:function(a){e=a},setPlayers:function(e){a=e[0],b=e[1],c=e[2],d=e[3]},getPlayer11:function(){return a},getPlayer12:function(){return b},getPlayer21:function(){return c},getPlayer22:function(){return d},getCurrent:function(){return e},clearPlayers:function(){a=null,b=null,c=null,d=null,e=null},clearCurrent:function(){e=null},rematch:function(){var e=a;a=c,c=e,e=b,b=d,d=e},setGameOn:function(a){f=a},getGameOn:function(){return f}}}]),app.factory("SocketService",["$http",function(){var a;return{setConnected:function(b){a=b},getSocket:function(){return a}}}]),app.controller("adminController",["$scope","$http","$location","SocketService","PlayersService",function(a,b,c){a.newName="",a.newImagePath="",a.newPassword="",a.errorMessageName="",a.errorMessagePassword="",a.addUser=function(d,e,f){var g=["jpeg","jpg","png"],h=document.getElementById("imgPath").value.split(".").pop().toLowerCase(),i=!1;if(""===a.newName)return void(a.errorMessageName="You must enter a valid name");if(a.errorMessageName="",""===a.newPassword)return void(a.errorMessagePassword="Your account must have a password");a.errorMessagePassword="";for(var j in g)if(h===g[j]){i=!0;break}i||(e="");var k={Name:d,ImagePath:e,Password:f},l=JSON.stringify(k),m={method:"POST",url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/tempUser.xsjs",headers:{"Content-Type":"application/json",dataType:"json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="},data:l};console.log(k),b(m).success(function(){console.log("successfully added user"),c.path("/users")}).error(function(b){a.errorMessage=b,console.log(b)})}}]),app.controller("HomeController",["$scope","$location","SocketService","PlayersService",function(a,b,c,d){a.topList={};var e="10.41.112.52:3000/",f=io.connect(e);$.ajax({url:"http://"+e+"players",type:"GET",success:function(b){b.length&&(a.player11=b[0],a.player12=b[1],a.player21=b[2],a.player22=b[3],d.setPlayers(b),d.setGameOn(!0),a.$digest()),console.log(b)},error:function(a){console.log(a)}}),$.ajax({url:"http://"+e+"getScore",type:"GET",success:function(a){$("#team1").text(a[0]),$("#team2").text(a[1])}}),f.on("goal1",function(a){$("#team1").text(a)}),f.on("goal2",function(a){$("#team2").text(a)}),f.on("gameover",function(){console.log("gameover")}),f.on("updatePlayers",function(b){d.setPlayers(b),a.player11=b[0],a.player12=b[1],a.player21=b[2],a.player22=b[3],a.$digest(),a.player11&&a.player12&&a.player21&&a.player22&&($("#startGame").hide(),$("#Rematch").hide(),$("#newGame").hide())}),a.clickplayer=function(c){11==c&&a.player11.UserId?b.path("/Users/"+a.player11.UserId):12==c&&a.player12.UserId?b.path("/Users/"+a.player12.UserId):21==c&&a.player21.UserId?b.path("/Users/"+a.player21.UserId):22==c&&a.player22.UserId&&b.path("/Users/"+a.player22.UserId)};var g={"Content-Type":"application/json",dataType:"json",Accept:"application/json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="};$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/usersELO.xsjs",type:"GET",dataType:"json",headers:g,contentType:"application/json; charset=utf-8",success:function(b){a.topList=b,a.$digest(),console.log(b)},error:function(){console.log("error : ")}})}]),app.controller("StatisticsController",["$scope","$location","SocketService",function(a,b){function c(a){return a>=60&&(min=parseInt(a/60),sek=a%60,a=min+"m "+sek+"s"),a}function d(b){for(var d=[],e=0;e<b.length;e++){var f={user1:"",user2:"",diffsec:0,user1Id:0,user2Id:0,user1Img:"",user2Img:""},g="";1==b[e].SLOWESTGOALTEAMID?(f.user1=b[e].SLOWESTGOALT1U1NAME,f.user2=b[e].SLOWESTGOALT1U2NAME,g=b[e].SLOWESTGOALDIFF_SEC,f.user1Id=b[e].SLOWESTGOALT1U1ID,f.user2Id=b[e].SLOWESTGOALT1U1ID,f.user1Img=b[e].SLOWESTGOALT1U1IMAGEPATH,f.user2Img=b[e].SLOWESTGOALT1U2IMAGEPATH):(f.user1=b[e].SLOWESTGOALT2U1NAME,f.user2=b[e].SLOWESTGOALT2U2NAME,g=b[e].SLOWESTGOALDIFF_SEC,f.user1Id=b[e].SLOWESTGOALT2U1ID,f.user2Id=b[e].SLOWESTGOALT2U1ID,f.user1Img=b[e].SLOWESTGOALT2U1IMAGEPATH,f.user2Img=b[e].SLOWESTGOALT2U2IMAGEPATH),f.diffsec=c(g),d.push(f)}a.slowgoalarr=d,a.$digest()}function e(b){for(var d=[],e=0;e<b.length;e++){var f={user1:"",user2:"",user3:"",user4:"",diffsec:0,user1Id:0,user2Id:0,user3Id:0,user4Id:0,user1Img:"",user2Img:"",user3Img:"",user4Img:""},g="";f.user1=b[e].SLOWESTGAMET1U1NAME,f.user2=b[e].SLOWESTGAMET1U2NAME,f.user3=b[e].SLOWESTGAMET2U1NAME,f.user4=b[e].SLOWESTGAMET2U2NAME,g=b[e].SLOWESTGAMELENGTH,f.user1Id=b[e].SLOWESTGAMET1U1ID,f.user2Id=b[e].SLOWESTGAMET1U2ID,f.user3Id=b[e].SLOWESTGAMET2U1ID,f.user4Id=b[e].SLOWESTGAMET2U2ID,f.user1Img=b[e].SLOWESTGAMET1U1IMAGEPATH,f.user2Img=b[e].SLOWESTGAMET1U2IMAGEPATH,f.user3Img=b[e].SLOWESTGAMET2U1IMAGEPATH,f.user4Img=b[e].SLOWESTGAMET2U2IMAGEPATH,f.diffsec=c(g),d.push(f)}a.slowgamearr=d,a.$digest()}function f(b){for(var d=[],e=0;e<b.length;e++){var f={user1:"",user2:"",diffsec:0,user1Id:0,user2Id:0,user1Img:"",user2Img:""},g="";1==b[e].SLOWESTGOALTEAMID?(f.user1=b[e].QUICKESTGOALT1U1NAME,f.user2=b[e].QUICKESTGOALT1U2NAME,g=b[e].QUICKESTGOALDIFF_SEC,f.user1Id=b[e].QUICKESTGOALT1U1ID,f.user2Id=b[e].QUICKESTGOALT1U1ID,f.user1Img=b[e].QUICKESTGOALT1U1IMAGEPATH,f.user2Img=b[e].QUICKESTGOALT1U2IMAGEPATH):(f.user1=b[e].QUICKESTGOALT2U1NAME,f.user2=b[e].QUICKESTGOALT2U2NAME,g=b[e].QUICKESTGOALDIFF_SEC,f.user1Id=b[e].QUICKESTGOALT2U1ID,f.user2Id=b[e].QUICKESTGOALT2U1ID,f.user1Img=b[e].QUICKESTGOALT2U1IMAGEPATH,f.user2Img=b[e].QUICKESTGOALT2U2IMAGEPATH),f.diffsec=c(g),d.push(f)}a.quickgoalarr=d,a.$digest()}function g(b){for(var d=[],e=0;e<b.length;e++){var f={user1:"",user2:"",user3:"",user4:"",diffsec:0,user1Id:0,user2Id:0,user3Id:0,user4Id:0,user1Img:"",user2Img:"",user3Img:"",user4Img:""},g="";f.user1=b[e].QUICKESTGAMET1U1NAME,f.user2=b[e].QUICKESTGAMET1U2NAME,f.user3=b[e].QUICKESTGAMET2U1NAME,f.user4=b[e].QUICKESTGAMET2U2NAME,g=b[e].SLOWESTGAMELENGTH,f.user1Id=b[e].QUICKESTGAMET1U1ID,f.user2Id=b[e].QUICKESTGAMET1U2ID,f.user3Id=b[e].QUICKESTGAMET2U1ID,f.user4Id=b[e].QUICKESTGAMET2U2ID,f.user1Img=b[e].QUICKESTGAMET1U1IMAGEPATH,f.user2Img=b[e].QUICKESTGAMET1U2IMAGEPATH,f.user3Img=b[e].QUICKESTGAMET2U1IMAGEPATH,f.user4Img=b[e].QUICKESTGAMET2U2IMAGEPATH,f.diffsec=c(g),d.push(f)}a.quickgamearr=d,a.$digest()}var h={"Content-Type":"application/json",dataType:"json",Accept:"application/json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="};$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/top10.xsjs",type:"GET",dataType:"json",headers:h,contentType:"application/json; charset=utf-8",success:function(a){d(a),e(a),f(a),g(a),console.log(a)}}),$(document).ready(function(){$("#lis1").click(function(){$("#l1").show(),$("#l2").hide(),$("#l3").hide(),$("#l4").hide()}),$("#lis2").click(function(){$("#l1").hide(),$("#l2").show(),$("#l3").hide(),$("#l4").hide()}),$("#lis3").click(function(){$("#l1").hide(),$("#l2").hide(),$("#l3").show(),$("#l4").hide()}),$("#lis4").click(function(){$("#l1").hide(),$("#l2").hide(),$("#l3").hide(),$("#l4").show()})}),a.getPlayer=function(a){console.log(a),b.path("users/")};var i="highlight",j=$(".thumbnail").click(function(a){a.preventDefault(),j.removeClass(i),$(this).addClass(i)})}]),app.controller("TableController",["$scope","$location","SocketService","PlayersService",function(a,b,c,d){var e="10.41.112.52:3000/",f=io.connect(e),g=!1;$.ajax({url:"http://"+e+"players",type:"GET",success:function(b){b.length?(a.player11=b[0],a.player12=b[1],a.player21=b[2],a.player22=b[3],d.setPlayers(b),g=!0,d.setGameOn(!0),a.$digest()):(a.player11="Player 1",a.player12="Player 2",a.player21="Player 1",a.player22="Player 2",d.setCurrent(null),d.getPlayer11()&&(a.player11=d.getPlayer11(),d.setCurrent(null)),d.getPlayer12()&&(a.player12=d.getPlayer12(),d.setCurrent(null)),d.getPlayer21()&&(a.player21=d.getPlayer21(),d.setCurrent(null)),d.getPlayer22()&&(a.player22=d.getPlayer22(),d.setCurrent(null)),d.getPlayer11()&&d.getPlayer12()&&d.getPlayer21()&&d.getPlayer22()&&$("#startGame").show(),a.$digest())}}),$.ajax({url:"http://"+e+"getScore",type:"GET",success:function(a){$("#team1").text(a[0]),$("#team2").text(a[1])}}),f.on("goal1",function(a){$("#team1").text(a)}),f.on("goal2",function(a){$("#team2").text(a)}),f.on("gameover",function(){$("#Rematch").show(),$("#newGame").show(),console.log("gameover")}),f.on("updatePlayers",function(b){d.setPlayers(b),a.player11=b[0],a.player12=b[1],a.player21=b[2],a.player22=b[3],a.$digest(),a.player11&&a.player12&&a.player21&&a.player22&&($("#startGame").hide(),$("#Rematch").hide(),$("#newGame").hide())}),a.clearCurrent=function(){console.log("worked")},a.clickplayer=function(c){g?11==c?b.path("/Users/"+a.player11.UserId):12==c?b.path("/Users/"+a.player12.UserId):21==c?b.path("/Users/"+a.player21.UserId):22==c&&b.path("/Users/"+a.player22.UserId):(d.setCurrent(c),b.path("/pickuser"))},a.gotoStatistics=function(){b.path("/statistics")},a.createGame=function(){$("#startGame").hide();var a={team1user1UserId:d.getPlayer11().UserId,team1user1Name:d.getPlayer11().Name,team1user1ImagePath:d.getPlayer11().ImagePath,ELO0:d.getPlayer11().ELO,team1user2UserId:d.getPlayer12().UserId,team1user2Name:d.getPlayer12().Name,team1user2ImagePath:d.getPlayer12().ImagePath,ELO1:d.getPlayer12().ELO,team2user1UserId:d.getPlayer21().UserId,team2user1Name:d.getPlayer21().Name,team2user1ImagePath:d.getPlayer21().ImagePath,ELO2:d.getPlayer21().ELO,team2user2UserId:d.getPlayer22().UserId,team2user2Name:d.getPlayer22().Name,team2user2ImagePath:d.getPlayer22().ImagePath,ELO3:d.getPlayer22().ELO};$.ajax({url:"http://"+e+"start",type:"POST",data:a,success:function(){g=!0,d.setGameOn(!0)}})},a.rematch=function(){d.rematch(),a.createGame(),a.player11=d.getPlayer11(),a.player12=d.getPlayer12(),a.player21=d.getPlayer21(),a.player22=d.getPlayer22(),$("#Rematch").hide(),$("#newGame").hide()},a.newGame=function(){g=!1,d.setGameOn(!1),$("#team1").text(0),$("#team2").text(0),d.clearPlayers(),a.player11=null,a.player12=null,a.player21=null,a.player22=null}}]),app.controller("UserController",["$scope","$location","SocketService","PlayersService",function(a,b,c,d){function e(c){for(var e=!1,f=[],g=0;g<c.length;g++)d.getPlayer11()&&"/users"!=b.$$path&&d.getPlayer11().UserId==c[g].UserId&&(e=!0),d.getPlayer12()&&"/users"!=b.$$path&&d.getPlayer12().UserId==c[g].UserId&&(e=!0),d.getPlayer21()&&"/users"!=b.$$path&&d.getPlayer21().UserId==c[g].UserId&&(e=!0),d.getPlayer22()&&"/users"!=b.$$path&&d.getPlayer22().UserId==c[g].UserId&&(e=!0),e||f.push(c[g]),e=!1;a.arr=f,a.$digest()}var f={"Content-Type":"application/json",dataType:"json",Accept:"application/json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="};$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/tempUser.xsjs",type:"GET",dataType:"json",headers:f,contentType:"application/json; charset=utf-8",success:function(a){e(a),console.log(a)}}),a.thisPlayer=function(a){d.getCurrent()?(11==d.getCurrent()?d.setPlayer11(a):12==d.getCurrent()?d.setPlayer12(a):21==d.getCurrent()?d.setPlayer21(a):22==d.getCurrent()&&d.setPlayer22(a),b.path("/table")):b.path("/Users/"+a.UserId)},a.randomPlayers=function(){for(var c=[];c.length<4;){for(var e=Math.ceil(Math.random()*a.arr.length-1),f=!1,g=0;g<c.length;g++)if(c[g]==e){f=!0;break}f||(c[c.length]=e)}d.setPlayer11(a.arr[c[0]]),d.setPlayer12(a.arr[c[1]]),d.setPlayer21(a.arr[c[2]]),d.setPlayer22(a.arr[c[3]]),b.path("/")}}]),app.controller("UserIDController",["$scope","$http","$location","$routeParams","SocketService","PlayersService",function(a,b,c,d){a.user={},a.winp=0,a.newName="",a.newImagePath="",a.password="",a.newPassword="",a.newPassword2="",a.errorMessagePassword="",a.errorMessageName="",a.noGamesPlayedError="";var e={"Content-Type":"application/json",dataType:"json",Accept:"application/json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="};$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/userStatistics.xsjs",type:"GET",dataType:"json",headers:e,contentType:"application/json; charset=utf-8",data:{id:d.UserId},success:function(b){console.log(b),b.length<=0?$.ajax({url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/userById.xsjs",type:"GET",dataType:"json",headers:e,contentType:"application/json; charset=utf-8",data:{id:d.UserId},success:function(b){a.user=b,a.user[0].NOGAMES=0,a.noGamesPlayedError="You have to play at least 5 game to get a ranking",a.newName=a.user[0].NAME,a.newImagePath=a.user[0].IMAGEPATH,a.$digest(),console.log(b)},error:function(a){console.log("error: "+a)}}):(console.log("haffis response: "+b),a.user=b,a.winp=(a.user[0].TOTWINS/a.user[0].NOGAMES*100).toFixed(2),a.newName=a.user[0].NAME,a.newImagePath=a.user[0].IMAGEPATH,a.newPassword="",a.$digest())},error:function(a){return console.log("error : "),a}}),a.goToPlayer=function(a){c.path("/Users/"+a)},a.editUser=function(){c.path("/editUser/"+a.user[0].USERID)},a.changePassword=function(){c.path("changePassword/"+a.user[0].USERID)},a.saveNewPassword=function(d,e){if(a.newPassword!==a.newPassword2)return void(a.errorMessagePassword="New password fields do not match");var f={UserId:a.user[0].USERID,Password:d,NewPassword:e},g=JSON.stringify(f),h={method:"POST",url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/changePassword.xsjs",headers:{"Content-Type":"application/json",dataType:"json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="},data:g};console.log(f),b(h).success(function(){console.log("successfully changed password"),c.path("/users")}).error(function(){a.errorMessagePassword="Wrong password"})},a.saveChanges=function(d,e,f){var g=["jpeg","jpg","png"],h=document.getElementById("imgPath").value.split(".").pop().toLowerCase(),i=!1;if(""===a.newName)return void(a.errorMessageName="You must have a valid name");if(a.errorMessageName="",""===a.password)return void(a.errorMessagePassword="Please enter your password");a.errorMessagePassword="";for(var j in g)if(h===g[j]){i=!0;break}i||(e=""),""===a.newName&&(d=a.user[0].NAME);var k={UserId:a.user[0].USERID,Name:d,ImagePath:e,Password:f},l=JSON.stringify(k),m={method:"POST",url:"http://apprekdbs01.ad.acme.is:8000/Fussball_Project/updateUser.xsjs",headers:{"Content-Type":"application/json",dataType:"json",Authorization:"Basic RlVTOlNhbGFzYW5hMTIzNA=="},data:l};console.log(k),b(m).success(function(){console.log("successfully updated user"),c.path("/users")}).error(function(){a.errorMessagePassword="Wrong password"})}}]);